<?xml version="1.0" encoding="UTF-8"?>
<idea-plugin>
    <!-- Phase 0.1: Initial project structure created. -->
    <!-- Metadata set as part of Phase 0.1 tasks. -->

    <id>dev.bluekachina.fmcuttingboard</id>
    <name>FMCuttingBoard</name>
    <vendor url="https://github.com/Blue-Kachina/fmcuttingboard">Blue Kachina</vendor>

    <!-- Compatibility configured via Gradle's patchPluginXml -->

    <description><![CDATA[
        Work with FileMaker clipboard content as XML (fmxmlsnippet) directly from your JetBrains IDE.

        The plugin adds a "FMCuttingBoard" submenu under the Tools menu with actions to:
        - Convert FM Clipboard To XML Clipboard
        - New XML File From FM Clipboard
        - Push Clipboard Into FileMaker

        Use it to inspect and version-control fmxmlsnippet payloads, and to reconstruct clipboard
        content from XML for pasting back into FileMaker (fields, scripts, etc.).
    ]]></description>

    <!-- Notifications group for user-facing balloon messages (registered via extensions) -->
    <extensions defaultExtensionNs="com.intellij">
        <notificationGroup id="FMCuttingBoard" displayType="BALLOON"/>
        <!-- Phase 7.1: Register project-level settings page -->
        <projectConfigurable id="dev.fmcuttingboard.settings"
                             displayName="FMCuttingBoard"
                             instance="dev.fmcuttingboard.settings.FmCuttingBoardConfigurable"/>
        <!-- Show a toolbar/banner when editing fmxmlsnippet XML files -->
        <editorNotificationProvider implementation="dev.fmcuttingboard.ui.FmXmlSnippetNotificationProvider"/>

        <!-- Phase 1.2: Register FileMaker Calculation file type -->
        <fileType name="FileMaker Calculation"
                  language="FileMakerCalculation"
                  implementationClass="dev.fmcuttingboard.language.FileMakerCalculationFileType"
                  extensions="fmcalc"/>

        <!-- Phase 3.2: Register syntax highlighter factory for FileMaker Calculation language -->
        <lang.syntaxHighlighterFactory language="FileMakerCalculation"
                                       implementationClass="dev.fmcuttingboard.language.FileMakerCalculationSyntaxHighlighterFactory"/>

        <!-- Advanced IDE Features (Post-MVP) -->
        <!-- Code completion for FileMaker functions -->
        <completion.contributor language="FileMakerCalculation"
                                implementationClass="dev.fmcuttingboard.language.completion.FileMakerCalculationCompletionContributor"/>

        <!-- Brace matching for parentheses and brackets -->
        <lang.braceMatcher language="FileMakerCalculation"
                           implementationClass="dev.fmcuttingboard.language.match.FileMakerCalculationBraceMatcher"/>

        <!-- Code folding for Let(), Case(), If() blocks -->
        <lang.foldingBuilder language="FileMakerCalculation"
                             implementationClass="dev.fmcuttingboard.language.folding.FileMakerCalculationFoldingBuilder"/>

        <!-- Error detection for invalid syntax (basic annotator) -->
        <annotator language="FileMakerCalculation"
                   implementationClass="dev.fmcuttingboard.language.validation.FileMakerCalculationAnnotator"/>

        <!-- Parameter hints for functions -->
        <lang.parameterInfo language="FileMakerCalculation"
                            implementationClass="dev.fmcuttingboard.language.hints.FileMakerCalculationParameterInfoHandler"/>

        <!-- Enable Reformat Code for fmcalc (minimal formatting model) -->
        <lang.formatter language="FileMakerCalculation"
                         implementationClass="dev.fmcuttingboard.language.format.FileMakerCalculationFormattingModelBuilder"/>

        <!-- Code style settings provider to surface preview/sample in settings -->
        <codeStyleSettingsProvider implementation="dev.fmcuttingboard.language.format.FileMakerCodeStyleSettingsProvider"/>

        <!-- ParserDefinition to enable PSI for the FileMaker Calculation language -->
        <lang.parserDefinition language="FileMakerCalculation"
                               implementationClass="dev.fmcuttingboard.language.parser.FileMakerCalculationParserDefinition"/>

    </extensions>

    <!-- Phase 1.1: Register base actions group under Tools menu -->
    <actions>
        <group id="dev.fmcuttingboard.toolsGroup"
               text="FMCuttingBoard"
               description="FMCuttingBoard tools"
               popup="true"
               icon="/icons/pluginIcon16.svg">
            <add-to-group group-id="ToolsMenu" anchor="last"/>
            <!-- Phase 1.2: Register submenu actions -->
            <action id="dev.fmcuttingboard.actions.ConvertClipboardToXml"
                    class="dev.fmcuttingboard.actions.ConvertClipboardToXmlAction"
                    text="Convert FM Clipboard To XML Clipboard"
                    description="Convert FileMaker clipboard contents to XML and place on clipboard">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt C" second-keystroke="X"/>
                <!-- Phase 7.2: Quick access in context menus -->
                <add-to-group group-id="EditorPopupMenu" anchor="last"/>
                <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
            </action>

            <action id="dev.fmcuttingboard.actions.ReadClipboardIntoNewXmlFile"
                    class="dev.fmcuttingboard.actions.ReadClipboardIntoNewXmlFileAction"
                    text="New XML File From FM Clipboard"
                    description="Create a new XML file from the current clipboard contents">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt C" second-keystroke="F"/>
                <!-- Phase 7.2: Quick access in context menus -->
                <add-to-group group-id="EditorPopupMenu" anchor="last"/>
                <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
            </action>

            <action id="dev.fmcuttingboard.actions.PushClipboardIntoFileMaker"
                    class="dev.fmcuttingboard.actions.PushClipboardIntoFileMakerAction"
                    text="Push Clipboard Into FileMaker"
                    description="Push XML or supported content on clipboard into FileMaker">
                <keyboard-shortcut keymap="$default" first-keystroke="ctrl alt C" second-keystroke="P"/>
                <!-- Phase 7.2: Quick access in context menus -->
                <add-to-group group-id="EditorPopupMenu" anchor="last"/>
                <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
            </action>

            <!-- Diagnostics: dump clipboard formats to IDE log (Windows only) -->
            <action id="dev.fmcuttingboard.actions.ClipboardFormatsDumpAction"
                    class="dev.fmcuttingboard.actions.ClipboardFormatsDumpAction"
                    text="Diagnostics: Dump Clipboard Formats"
                    description="Log current Windows clipboard formats and light size info">
                <add-to-group group-id="EditorPopupMenu" anchor="last"/>
                <add-to-group group-id="ProjectViewPopupMenu" anchor="last"/>
            </action>

        </group>
    </actions>
</idea-plugin>
